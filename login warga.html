<!DOCTYPE html>
<html lang="id">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />

<title>Login & Form Sensus Penduduk Purbalingga 2025</title>
<style>
  body, html {
    margin:0; padding:0; font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; background: #f0f2f5;
  }
  #loginRegisterSection, #formSensusSection {
    max-width: 400px; margin: 50px auto; background: white; padding: 25px; border-radius: 8px;
    box-shadow: 0 0 12px rgba(0,0,0,0.1);
  }
  h2 {
    text-align: center; color: #2c3e50;
  }
  input[type=text], input[type=password], input[type=date], input[type=number], select, textarea {
    width: 100%; padding: 10px; margin: 8px 0 15px 0; border: 1px solid #ccc; border-radius: 4px;
    box-sizing: border-box; font-size: 1rem;
  }
  button {
    width: 100%; background-color: #e67e22; color: white; padding: 12px; border: none; border-radius: 4px;
    font-weight: 700; cursor: pointer; font-size: 1rem;
  }
  button:hover {
    background-color: #d35400;
  }
  #toggleForm {
    margin-top: 12px; text-align: center; color: #e67e22; cursor: pointer; text-decoration: underline;
  }
  .msg {
    text-align: center; padding: 10px; border-radius: 4px; margin-bottom: 12px; display:none;
  }
  .error {
    background: #ff6b6b; color: white;
  }
  .success {
    background: #2ecc71; color: white;
  }
  label {
    font-weight: 600;
  }
  textarea {
    resize: vertical;
  }
  #logoutBtn {
    background: #e74c3c; margin-top: 15px;
  }
</style>
</head>
<body>

<div id="loginRegisterSection">
  <h2 id="formTitle">Login Warga Purbalingga</h2>
  <div id="message" class="msg"></div>

  <!-- Form Login -->
  <form id="loginForm">
    <input type="text" id="loginUsername" placeholder="Username" required autocomplete="off" />
    <input type="password" id="loginPassword" placeholder="Password" required autocomplete="off" />
    <button type="submit">Login</button>
  </form>

  <!-- Form Register -->
  <form id="registerForm" style="display:none;">
    <input type="text" id="regUsername" placeholder="Username" required autocomplete="off" />
    <input type="password" id="regPassword" placeholder="Password" required autocomplete="off" />
    <input type="password" id="regConfirmPassword" placeholder="Konfirmasi Password" required autocomplete="off" />
    <button type="submit">Daftar Sekarang</button>
  </form>

  <div id="toggleForm">Belum punya akun? Daftar sekarang</div>
</div>

<div id="formSensusSection" style="display:none;">
  <h2>Formulir Sensus Penduduk Purbalingga 2025</h2>
  <form id="formSensus">
    <label for="nik">NIK (Nomor Induk Kependudukan)</label>
    <input type="text" id="nik" maxlength="16" minlength="16" pattern="\d{16}" placeholder="16 digit angka" required />

    <label for="nama">Nama Lengkap</label>
    <input type="text" id="nama" placeholder="Nama sesuai KTP" required />

    <label for="tempatLahir">Tempat Lahir</label>
    <input type="text" id="tempatLahir" required />

    <label for="tanggalLahir">Tanggal Lahir</label>
    <input type="date" id="tanggalLahir" required />

    <label for="jenisKelamin">Jenis Kelamin</label>
    <select id="jenisKelamin" required>
      <option value="" disabled selected>-- Pilih Jenis Kelamin --</option>
      <option value="Laki-laki">Laki-laki</option>
      <option value="Perempuan">Perempuan</option>
    </select>

    <label for="alamat">Alamat Lengkap</label>
    <textarea id="alamat" rows="3" placeholder="Jl, RT/RW, Desa/Kelurahan, Kecamatan, Kabupaten" required></textarea>

    <label for="pekerjaan">Pekerjaan</label>
    <input type="text" id="pekerjaan" placeholder="Pekerjaan saat ini" required />

    <label for="statusKawin">Status Perkawinan</label>
    <select id="statusKawin" required>
      <option value="" disabled selected>-- Pilih Status Perkawinan --</option>
      <option value="Belum Kawin">Belum Kawin</option>
      <option value="Kawin">Kawin</option>
      <option value="Cerai Hidup">Cerai Hidup</option>
      <option value="Cerai Mati">Cerai Mati</option>
    </select>

    <button type="submit">Kirim Data Sensus</button>
  </form>

  <button id="logoutBtn">Logout</button>
</div>

<script>
  // Data akun warga tersimpan di localStorage (usersWarga)
  let usersWarga = JSON.parse(localStorage.getItem('usersWarga')) || [];

  // Data sensus tersimpan di localStorage (dataSensus)
  let dataSensus = JSON.parse(localStorage.getItem('dataSensus')) || [];

  const loginRegisterSection = document.getElementById('loginRegisterSection');
  const formSensusSection = document.getElementById('formSensusSection');

  const formTitle = document.getElementById('formTitle');
  const toggleForm = document.getElementById('toggleForm');
  const message = document.getElementById('message');

  const loginForm = document.getElementById('loginForm');
  const registerForm = document.getElementById('registerForm');
  const formSensus = document.getElementById('formSensus');

  // Cek login status sessionStorage
  function checkLogin() {
    const loggedUser = sessionStorage.getItem('loggedInUserWarga');
    if (loggedUser) {
      loginRegisterSection.style.display = 'none';
      formSensusSection.style.display = 'block';
      message.style.display = 'none';
      loadUserSensusData(loggedUser);
    } else {
      loginRegisterSection.style.display = 'block';
      formSensusSection.style.display = 'none';
      message.style.display = 'none';
      showLogin();
    }
  }

  // Show login form, hide register
  function showLogin() {
    formTitle.textContent = 'Login Warga Purbalingga';
    loginForm.style.display = 'block';
    registerForm.style.display = 'none';
    toggleForm.textContent = 'Belum punya akun? Daftar sekarang';
    clearMessages();
  }

  // Show register form, hide login
  function showRegister() {
    formTitle.textContent = 'Daftar Akun Warga';
    loginForm.style.display = 'none';
    registerForm.style.display = 'block';
    toggleForm.textContent = 'Sudah punya akun? Login di sini';
    clearMessages();
  }

  // Clear message
  function clearMessages() {
    message.textContent = '';
    message.className = 'msg';
    message.style.display = 'none';
  }

  // Toggle login/register form
  toggleForm.addEventListener('click', () => {
    if (loginForm.style.display === 'block') {
      showRegister();
    } else {
      showLogin();
    }
  });

  // Register form submit
  registerForm.addEventListener('submit', e => {
    e.preventDefault();
    clearMessages();

    const username = document.getElementById('regUsername').value.trim();
    const password = document.getElementById('regPassword').value.trim();
    const confirmPassword = document.getElementById('regConfirmPassword').value.trim();

    if (username.length < 3) {
      showError('Username minimal 3 karakter.');
      return;
    }
    if (password.length < 6) {
      showError('Password minimal 6 karakter.');
      return;
    }
    if (password !== confirmPassword) {
      showError('Password dan konfirmasi password tidak cocok.');
      return;
    }
    if (usersWarga.some(u => u.username === username)) {
      showError('Username sudah terdaftar.');
      return;
    }

    usersWarga.push({ username, password });
    localStorage.setItem('usersWarga', JSON.stringify(usersWarga));
    showSuccess('Pendaftaran berhasil! Silakan login.');
    registerForm.reset();
  });

  // Login form submit
  loginForm.addEventListener('submit', e => {
    e.preventDefault();
    clearMessages();

    const username = document.getElementById('loginUsername').value.trim();
    const password = document.getElementById('loginPassword').value.trim();

    const user = usersWarga.find(u => u.username === username && u.password === password);
    if (user) {
      sessionStorage.setItem('loggedInUserWarga', username);
      checkLogin();
    } else {
      showError('Username atau password salah.');
    }
  });

  // Form pengisian sensus submit
  formSensus.addEventListener('submit', e => {
    e.preventDefault();
    clearMessages();

    const nik = document.getElementById('nik').value.trim();
    const nama = document.getElementById('nama').value.trim();
    const tempatLahir = document.getElementById('tempatLahir').value.trim();
    const tanggalLahir = document.getElementById('tanggalLahir').value;
    const jenisKelamin = document.getElementById('jenisKelamin').value;
    const alamat = document.getElementById('alamat').value.trim();
    const pekerjaan = document.getElementById('pekerjaan').value.trim();
    const statusKawin = document.getElementById('statusKawin').value;

    // Validasi sederhana
    if (!/^\d{16}$/.test(nik)) {
      showError('NIK harus 16 digit angka.');
      return;
    }

    // Cek apakah NIK sudah pernah diinput
    const exist = dataSensus.find(d => d.nik === nik);
    if (exist) {
      showError('Data dengan NIK ini sudah pernah diinput.');
      return;
    }

    const sensusData = {
      username: sessionStorage.getItem('loggedInUserWarga'),
      nik,
      nama,
      tempatLahir,
      tanggalLahir,
      jenisKelamin,
      alamat,
      pekerjaan,
      statusKawin,
      tanggalInput: new Date().toISOString()
    };

    dataSensus.push(sensusData);
    localStorage.setItem('dataSensus', JSON.stringify(dataSensus));

    showSuccess('Data sensus berhasil dikirim! Terima kasih telah mengisi formulir.');
    formSensus.reset();
  });

  // Logout
  document.getElementById('logoutBtn').addEventListener('click', () => {
    sessionStorage.removeItem('loggedInUserWarga');
    checkLogin();
  });

  // Show error message
  function showError(msg) {
    message.textContent = msg;
    message.className = 'msg error';
    message.style.display = 'block';
  }
  // Show success message
  function showSuccess(msg) {
    message.textContent = msg;
    message.className = 'msg success';
    message.style.display = 'block';
  }

  // Jika pengguna sudah pernah isi form, kita bisa muat data itu (opsional)
  function loadUserSensusData(username) {
    const data = dataSensus.find(d => d.username === username);
    if (data) {
      // Contoh: isi form dengan data yang sudah ada (bisa diubah sesuai kebutuhan)
      document.getElementById('nik').value = data.nik;
      document.getElementById('nama').value = data.nama;
      document.getElementById('tempatLahir').value = data.tempatLahir;
      document.getElementById('tanggalLahir').value = data.tanggalLahir;
      document.getElementById('jenisKelamin').value = data.jenisKelamin;
      document.getElementById('alamat').value = data.alamat;
      document.getElementById('pekerjaan').value = data.pekerjaan;
      document.getElementById('statusKawin').value = data.statusKawin;
    } else {
      formSensus.reset();
    }
  }

  // Inisialisasi cek login saat halaman dibuka
  checkLogin();
</script>

</body>
</html>
